<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <h2 style="color: green"> Reset Your Password </h2>
    <form id="resetform">
        <span> Old Password : </span>
        <input type="password" name="old_password" placeholder="Your old password">
        <br />
        <span> New Password : </span>
        <input type="password" name="new_password" placeholder="Your new password">
        <br />
        <input type="submit" value="Reset Password">
    </form>

    <h3> <a href="/"> Home </a></h3>

    <script>

        // Check if user is logged in
        if (window.sessionStorage.accessToken == null) {
            alert("You are not logged in");
            window.location = '/';
        } else {
            $('#resetform').submit(function (e) {
                e.preventDefault(); // Prevent default submission

                var data = $('#resetform').serializeArray().reduce(function (obj, item) {
                    if (item.value !== "")
                        obj[item.name] = item.value;
                    return obj;
                }, {});

                console.log(data);
                $.ajax({
                    type: 'POST',
                    url: '/api/user/resetPassword',
                    beforeSend: function (request) {
                        request.setRequestHeader("x-auth-token", window.sessionStorage.accessToken);
                    },
                    contentType: 'application/x-www-form-urlencoded',
                    data: data,
                    success: function (responseData, textStatus, jqXHR) {
                        let data = responseData.data;
                        console.log(data);
                        window.sessionStorage.accessToken = data.token;
                        alert('Your Password has been successfully reset');
                        window.location = '/';
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        var err = jqXHR.responseJSON
                        alert(err.message);
                        console.log(errorThrown);
                    }
                });
            });
        }
    </script>
</body>

</html>